(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5cfe0bf6"],{"19c8":function(t,e,n){},"4cf2":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"imageContainer"},[n("a-form",{attrs:{layout:"inline",form:t.form}},[n("a-form-item",[n("a-input",{directives:[{name:"focus",rawName:"v-focus"}],staticStyle:{width:"400px"},attrs:{placeholder:"搜索关键词"},on:{change:t.onSearchKeyChange},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}},[n("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),n("a-form-item",[n("a-space",[n("a-button",{attrs:{"html-type":"reset"},on:{click:t.reloadContainer}},[n("a-icon",{attrs:{type:"reload"}}),t._v(" 刷新 ")],1),n("a-checkbox",{on:{change:t.onlyRunContainerChanged},model:{value:t.onlyRunContainer,callback:function(e){t.onlyRunContainer=e},expression:"onlyRunContainer"}},[t._v(" 仅运行中的容器 ")])],1)],1)],1),n("a-table",{staticStyle:{"margin-top":"30px"},attrs:{columns:t.columns,"data-source":t.containerList},scopedSlots:t._u([{key:"action",fn:function(e,a){return n("span",{},[n("a-space",["已停止"===a.state||"已创建"===a.state?[n("a",{attrs:{href:"#"},on:{click:function(e){return t.callControlContainerApi(a.containerId,"start")}}},[n("span",{staticStyle:{color:"green"}},[t._v("启动")])]),n("a-divider",{attrs:{type:"vertical"}})]:t._e(),"运行中"===a.state?[n("a",{attrs:{href:"#"},on:{click:function(e){return t.callControlContainerApi(a.containerId,"stop")}}},[n("span",{staticStyle:{color:"red"}},[t._v("停止")])]),n("a-divider",{attrs:{type:"vertical"}})]:t._e(),n("a",{attrs:{href:"#"},on:{click:function(e){return t.openContainerLogModal(a.containerId)}}},[t._v("日志")]),n("a-divider",{attrs:{type:"vertical"}}),n("a-dropdown",[n("a",{staticClass:"ant-dropdown-link",on:{click:function(t){return t.preventDefault()}}},[t._v("更多 "),n("a-icon",{attrs:{type:"down"}})],1),n("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[n("a-menu-item",[n("a",{attrs:{href:"#"},on:{click:function(e){return t.openDetail(a.containerId)}}},[t._v("容器详情")])]),n("a-menu-item",[n("a",{attrs:{href:"#"},on:{click:function(e){return t.callControlContainerApi(a.containerId,"restart")}}},[t._v("重启容器")])]),n("a-menu-item",[n("a",{attrs:{href:"#"},on:{click:function(e){return t.openRemoveDetail(a.containerId)}}},[t._v("删除容器")])]),n("a-menu-item",[n("a",{attrs:{href:"#"}},[t._v("导出容器")])])],1)],1)],2)],1)}}])}),n("a-drawer",{attrs:{placement:"right",width:"800px",visible:t.showContainerDetail},on:{close:t.onDrawClosed}},[n("a-collapse",{attrs:{activeKey:["info"]}},[n("a-collapse-panel",{key:"info",attrs:{header:"容器信息"}},[n("p",[t._v("Id: "+t._s(t.containerInfo.Id))]),n("p",[t._v("名称: "+t._s(t.containerInfo.Name))]),n("p",[t._v("平台: "+t._s(t.containerInfo.Platform))]),n("p",[t._v("启动参数: "+t._s(t.containerInfo.Args))]),n("p",[t._v("容器状态: "+t._s(t.containerInfo.State.Status))]),n("p",[t._v("存储驱动: "+t._s(t.containerInfo.Driver))]),n("p",[t._v("重启次数: "+t._s(t.containerInfo.RestartCount))])]),n("a-collapse-panel",{key:"webConfig",attrs:{header:"网络配置"}},[n("p",[t._v("端口映射表")]),n("table",{staticClass:"configTable"},[n("tr",[n("td",[t._v("容器端口")]),n("td",[t._v("宿主机端口")])]),t._l(this.containerPorts,(function(e){return[n("tr",[n("td",[t._v(t._s(e.containerPort))]),n("td",[t._v(" "+t._s(e.portConfig))])])]}))],2),n("p",[t._v("网络地址")]),t._l(t.containerNetworkInfo,(function(e,a,r){return[n("table",{staticClass:"configTable"},[n("tr",[n("td",{staticClass:"tagTd"},[t._v("网络名")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(a))])]),n("tr",[n("td",{staticClass:"tagTd"},[t._v("网络ID")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(e.NetworkID))])]),n("tr",[n("td",{staticClass:"tagTd"},[t._v("网关地址")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(e.Gateway))])]),n("tr",[n("td",{staticClass:"tagTd"},[t._v("IP 地址")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(e.IPAddress))])]),n("tr",[n("td",{staticClass:"tagTd"},[t._v("Mac 地址")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(t._s(e.MacAddress))])])])]}))],2),n("a-collapse-panel",{key:"volumeConfig",attrs:{header:"存储配置"}},[t._l(t.containerMountInfo,(function(e){return[n("table",{staticClass:"configTable"},[n("tr",[n("td",{staticClass:"tagTd"},[t._v("名称")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(e.Name))])]),n("tr",[n("td",{staticClass:"tagTd"},[t._v("类型")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(e.Type))])]),n("tr",[n("td",{staticClass:"tagTd"},[t._v("可读写")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(e.RW))])]),n("tr",[n("td",{staticClass:"tagTd"},[t._v("宿主目录")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(e.Source))])]),n("tr",[n("td",{staticClass:"tagTd"},[t._v("容器目录")]),n("td",{staticClass:"contentTd",attrs:{align:"left"}},[t._v(" "+t._s(e.Destination))])])])]}))],2)],1)],1),n("a-modal",{attrs:{title:"最近日志",width:"60%",okText:"下载全部日志",cancelText:"关闭"},on:{ok:function(e){return t.downloadAllLog()}},model:{value:t.showLogVisible,callback:function(e){t.showLogVisible=e},expression:"showLogVisible"}},[n("pre",{staticStyle:{"overflow-y":"scroll","overflow-x":"auto",height:"400px"}},[t._v(t._s(this.formatLog))])]),n("a-modal",{attrs:{title:"删除容器选项",okText:"确定",cancelText:"关闭"},on:{ok:t.callRemoveContainerApi},model:{value:t.showRemoveVisible,callback:function(e){t.showRemoveVisible=e},expression:"showRemoveVisible"}},[n("a-checkbox",{attrs:{checked:t.remove.volume},on:{change:t.removeVolume}},[t._v("移除 Volume ")]),n("a-checkbox",{attrs:{checked:t.remove.link},on:{change:t.removeLink}},[t._v("移除 Links ")]),n("a-checkbox",{attrs:{checked:t.remove.force},on:{change:t.removeForce}},[t._v("强制移除 ")])],1)],1)},r=[],o=(n("4de4"),n("c975"),n("b64b"),n("ac1f"),n("5319"),n("498a"),n("9911"),n("96cf"),n("1da1")),i=n("5530"),c=n("2f62"),s=(n("99af"),n("bc3a")),l=n.n(s);function u(t){switch(t){case"start":return"启动";case"restart":return"重启";case"stop":return"停止"}}function d(t){var e=this,n=l.a.get("/api/container/log/part/".concat(t));return n.catch((function(t){e.$notification["warning"]({message:"操作失败",description:"操作失败,请检查 Docker 服务是否正常"})})),n}function f(t,e,n){var a=this,r=l.a.get("/api/container/".concat(e,"/").concat(t));return r.catch((function(t){a.$notification["error"]({message:"".concat(n,"容器失败"),description:"".concat(n,"容器失败,请检查 Docker 服务是否正常")})})),r}function v(t,e){return l.a.get("/api/container/delete/".concat(t),{params:e})}function h(t){var e={withCredentials:!0,timeout:6e5},n={responseType:"blob"};return l.a.create(e).get("/api/container/log/all/".concat(t),n)}var g={removeContainer:v,controlContainer:f,getContainerLog:d,getContainerAllLog:h,getOperatorNameByState:u},p=n("ed08"),m=[{title:"容器ID",key:"containerId",dataIndex:"containerId"},{title:"容器名称",dataIndex:"containerName",key:"containerName"},{title:"镜像",dataIndex:"imageName",key:"imageName"},{title:"状态",dataIndex:"state",key:"state"},{title:"创建时间",key:"created",dataIndex:"created"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],C={data:function(){return{form:{},showLogVisible:!1,showContainerDetail:!1,showRemoveVisible:!1,currentContainerId:"",containerLog:"",searchKey:"",columns:m,onlyRunContainer:!1,remove:{volume:!0,link:!1,force:!0}}},computed:{containerList:function(){var t=this,e=this.$store.state.container.containerList;if(""!==this.searchKey&&""!==this.searchKey.trim()){var n=function(e){return e.containerLongId.indexOf(t.searchKey)>=0},a=function(e){return e.containerName.indexOf(t.searchKey)>=0},r=function(e){return e.imageName.indexOf(t.searchKey)>=0};e=e.filter((function(t){return n(t)||a(t)||r(t)}))}return this.onlyRunContainer?e.filter((function(t){return"运行中"===t.state})):e},containerInfo:function(){return this.$store.state.container.containerInfo},containerMountInfo:function(){var t=this.containerInfo.Mounts;return t||[]},containerNetworkInfo:function(){var t=this.containerInfo.NetworkSettings;return t?t.Networks:{}},containerPorts:function(){var t=[],e=this.$store.state.container.containerInfo.HostConfig.PortBindings;if(!e)return t;var n=Object.keys(e);for(var a in n){var r=n[a],o=e[r];for(var i in o){var c=o[i];t.push({containerPort:r,portConfig:c.HostPort})}}return t},formatLog:function(){var t="";return t=this.containerLog.replace("/\r\n/g","<br/>"),t=t.replace("\n/g","<br/>"),t=t.replace("/s/g","&nbsp;"),t}},mounted:function(){this.updateContainerList()},methods:Object(i["a"])(Object(i["a"])({},Object(c["b"])({updateContainerList:"updateContainerList",updateContainerInfo:"updateContainerInfo"})),{},{onSearchKeyChange:function(t){this.searchKey=t.target.value},openDetail:function(t){this.showContainerDetail=!0,this.updateContainerInfo(t)},onDrawClosed:function(){this.showContainerDetail=!1},reloadContainer:function(){this.updateContainerList(),this.$message.info("刷新容器列表完成")},downloadAllLog:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.showLogVisible=!1,n=t.$success({title:"正在导出,请稍等...",content:"正在导出，稍后会自动下载......."}),a=t.currentContainerId,e.prev=3,e.next=6,g.getContainerAllLog(a);case 6:r=e.sent,t.$message.info("获取容器全部日志完成,正在下载，请稍后...."),Object(p["download"])(r.data,"".concat(a,"-all.log"));case 9:return e.prev=9,n.destroy(),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[3,,9,12]])})))()},removeVolume:function(t){this.remove.volume=t.target.checked},removeLink:function(t){this.remove.link=t.target.checked},removeForce:function(t){this.remove.force=t.target.checked},openRemoveDetail:function(t){this.showRemoveVisible=!0,this.currentContainerId=t},onlyRunContainerChanged:function(t){this.onlyRunContainer=t.target.checked},callRemoveContainerApi:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n,a,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,g.removeContainer(t.currentContainerId,t.remove);case 2:n=e.sent,a=n.data,r=a.code,o=a.msg,"OK"===r?(t.$message.info("移除容器成功"),t.showRemoveVisible=!1,t.updateContainerList()):t.$message.error(o);case 5:case"end":return e.stop()}}),e)})))()},callControlContainerApi:function(t,e){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r,o,i,c,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e){a.next=2;break}return a.abrupt("return");case 2:return n.currentContainerId=t,r=g.getOperatorNameByState(e),o=Object(p["guid"])(),n.$message.loading({content:"正在".concat(r," 容器，请稍后....."),key:o,duration:0}),a.prev=6,a.next=9,g.controlContainer(t,e,r);case 9:i=a.sent,c=i.data,s=c.code,l=c.msg,"OK"===s?(n.$message.info({content:"".concat(r," 容器成功"),key:o}),n.updateContainerList()):n.$message.info({content:l,key:o}),a.next=17;break;case 14:a.prev=14,a.t0=a["catch"](6),n.$message.error({content:"服务连接失败，请检查服务是否正常启动",key:o});case 17:case"end":return a.stop()}}),a,null,[[6,14]])})))()},openContainerLogModal:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var a,r,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.showLogVisible=!0,e.currentContainerId=t,n.next=4,g.getContainerLog(t);case 4:a=n.sent,r=a.data,o=r.code,i=r.data,"OK"===o&&(e.containerLog=i,e.showLogVisible=!0);case 7:case"end":return n.stop()}}),n)})))()}})},_=C,k=(n("b0a3"),n("2877")),w=Object(k["a"])(_,a,r,!1,null,"365e4dc5",null);e["default"]=w.exports},"857a":function(t,e,n){var a=n("1d80"),r=/"/g;t.exports=function(t,e,n,o){var i=String(a(t)),c="<"+e;return""!==n&&(c+=" "+n+'="'+String(o).replace(r,"&quot;")+'"'),c+">"+i+"</"+e+">"}},9911:function(t,e,n){"use strict";var a=n("23e7"),r=n("857a"),o=n("af03");a({target:"String",proto:!0,forced:o("link")},{link:function(t){return r(this,"a","href",t)}})},af03:function(t,e,n){var a=n("d039");t.exports=function(t){return a((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},b0a3:function(t,e,n){"use strict";n("19c8")}}]);
//# sourceMappingURL=chunk-5cfe0bf6.58c05e48.js.map